!function(){var e={6401:function(e,t,r){r(7832),e.exports=self.fetch.bind(self)},7832:function(e,t,r){"use strict";r.r(t),r.d(t,{DOMException:function(){return w},Headers:function(){return l},Request:function(){return g},Response:function(){return v},fetch:function(){return T}});var n="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==r.g&&r.g||{},o={searchParams:"URLSearchParams"in n,iterable:"Symbol"in n&&"iterator"in Symbol,blob:"FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in n,arrayBuffer:"ArrayBuffer"in n};if(o.arrayBuffer)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=ArrayBuffer.isView||function(e){return e&&i.indexOf(Object.prototype.toString.call(e))>-1};function a(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function u(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return o.iterable&&(t[Symbol.iterator]=function(){return t}),t}function l(e){this.map={},e instanceof l?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){if(2!=e.length)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function f(e){if(!e._noBody)return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function d(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function h(e){var t=new FileReader,r=d(t);return t.readAsArrayBuffer(e),r}function p(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:o.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:o.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:o.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():o.arrayBuffer&&o.blob&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=p(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||s(e))?this._bodyArrayBuffer=p(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):o.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o.blob&&(this.blob=function(){var e=f(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=f(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}if(o.blob)return this.blob().then(h);throw new Error("could not read as ArrayBuffer")},this.text=function(){var e,t,r,n,o,i=f(this);if(i)return i;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=d(t),n=/charset=([A-Za-z0-9_-]+)/.exec(e.type),o=n?n[1]:"utf-8",t.readAsText(e,o),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o.formData&&(this.formData=function(){return this.text().then(m)}),this.json=function(){return this.text().then(JSON.parse)},this}l.prototype.append=function(e,t){e=a(e),t=c(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},l.prototype.delete=function(e){delete this.map[a(e)]},l.prototype.get=function(e){return e=a(e),this.has(e)?this.map[e]:null},l.prototype.has=function(e){return this.map.hasOwnProperty(a(e))},l.prototype.set=function(e,t){this.map[a(e)]=c(t)},l.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},l.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),u(e)},l.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),u(e)},l.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),u(e)},o.iterable&&(l.prototype[Symbol.iterator]=l.prototype.entries);var b=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function g(e,t){if(!(this instanceof g))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,o,i=(t=t||{}).body;if(e instanceof g){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new l(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new l(t.headers)),this.method=(r=t.method||this.method||"GET",o=r.toUpperCase(),b.indexOf(o)>-1?o:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in n)return(new AbortController).signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var s=/([?&])_=[^&]*/;if(s.test(this.url))this.url=this.url.replace(s,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function m(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}})),t}function v(e,t){if(!(this instanceof v))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new l(t.headers),this.url=t.url||"",this._initBody(e)}g.prototype.clone=function(){return new g(this,{body:this._bodyInit})},y.call(g.prototype),y.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},v.error=function(){var e=new v(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var E=[301,302,303,307,308];v.redirect=function(e,t){if(-1===E.indexOf(t))throw new RangeError("Invalid status code");return new v(null,{status:t,headers:{location:e}})};var w=n.DOMException;try{new w}catch(e){(w=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),w.prototype.constructor=w}function T(e,t){return new Promise((function(r,i){var s=new g(e,t);if(s.signal&&s.signal.aborted)return i(new w("Aborted","AbortError"));var u=new XMLHttpRequest;function f(){u.abort()}if(u.onload=function(){var e,t,n={statusText:u.statusText,headers:(e=u.getAllResponseHeaders()||"",t=new l,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();try{t.append(n,o)}catch(e){}}})),t)};0===s.url.indexOf("file://")&&(u.status<200||u.status>599)?n.status=200:n.status=u.status,n.url="responseURL"in u?u.responseURL:n.headers.get("X-Request-URL");var o="response"in u?u.response:u.responseText;setTimeout((function(){r(new v(o,n))}),0)},u.onerror=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},u.ontimeout=function(){setTimeout((function(){i(new TypeError("Network request timed out"))}),0)},u.onabort=function(){setTimeout((function(){i(new w("Aborted","AbortError"))}),0)},u.open(s.method,function(e){try{return""===e&&n.location.href?n.location.href:e}catch(t){return e}}(s.url),!0),"include"===s.credentials?u.withCredentials=!0:"omit"===s.credentials&&(u.withCredentials=!1),"responseType"in u&&(o.blob?u.responseType="blob":o.arrayBuffer&&(u.responseType="arraybuffer")),t&&"object"==typeof t.headers&&!(t.headers instanceof l||n.Headers&&t.headers instanceof n.Headers)){var d=[];Object.getOwnPropertyNames(t.headers).forEach((function(e){d.push(a(e)),u.setRequestHeader(e,c(t.headers[e]))})),s.headers.forEach((function(e,t){-1===d.indexOf(t)&&u.setRequestHeader(t,e)}))}else s.headers.forEach((function(e,t){u.setRequestHeader(t,e)}));s.signal&&(s.signal.addEventListener("abort",f),u.onreadystatechange=function(){4===u.readyState&&s.signal.removeEventListener("abort",f)}),u.send(void 0===s._bodyInit?null:s._bodyInit)}))}T.polyfill=!0,n.fetch||(n.fetch=T,n.Headers=l,n.Request=g,n.Response=v)},5581:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createInstance=function(e,t){const{globalContext:r}=t,o=new Map,s=new Map,{networkMonitor:a,networkState:f}=(0,u.createNetworkMonitor)(),d=(0,h.trackNetworkState)(a,(0,i.catchFailedToFetch)((0,l.rawSendConstructor)(r,t.configuration))),{trackHealth:p,...y}=(0,c.createHealthApi)();return{createApi:r=>g(r,e,{...t,cancellationMap:o,trackHealth:p,throttleMap:s},d),createCancelToken:()=>{const e=(0,n.v4)();return{token:e,cancel:()=>{const t=o.get(e);return t&&t.abort(),!t}}},networkState:f,health:y}};const n=r(3216),o=r(3851),i=r(81),s=r(2182),a=r(3403),c=r(2153),u=r(3974),l=r(3616),f=r(6507),d=r(956),h=r(7051),p=r(9370),y=r(86),b=r(3011);const g=(e,t,r,n)=>{const o={},i=e(t),{baseUrlPromise:s,models:a}=i;s&&s();for(const e in a){const t=a[e];o[e]=m(e,t,i,r,n)}return o},m=(e,t,r,n,i)=>{const{trackHealth:c,throttleMap:u,globalContext:l}=n,h=(0,f.throttleFactory)(l,t,u),{telemetryProvider:g}=n,{serviceName:m}=r;return async(...u)=>{let f,v,E,w;const T=(new Date).toISOString(),_=performance.now();try{const e=await(0,d.timed)(t.catch((e=>{throw(0,o.createError)(p.ErrorReason.ModelFailedToInitialize,void 0,e)})),l,n.configuration.modelInitializationTimeoutInMs,p.ErrorReason.ModelTimeOut);let y=(0,s.composeSend)(i,e,r,n);f=e.constructRequest(...u),f.operationLogger=(0,b.createOperationLogger)(f),y=c(y,r.serviceName,e.healthPolicy),y=h(y);try{w=e.customTelemetry?.(...u)}catch(e){throw(0,o.createError)(p.ErrorReason.CustomTelemetryFailed,void 0,e)}return v=await y(f),(0,a.createTransform)(e)(v)}catch(e){throw e.serverResponse&&(v=e.serverResponse),E=e,e}finally{const t=performance.now()-_,r=f?.correlationId,n=v?.status,o=n&&y.Status[n]||void 0,i=f?.operationLogger.complete({result:o,resultError:E},v)||[];g({apiName:e,serviceName:m,createdTime:T,parameters:w,duration:t,result:E?.reason||o||"",innerError:E?.innerException,operationLogs:i,correlationId:r})}}}},3851:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createError=function(e,t,r){const n=new Error(e);return Object.assign(n,{reason:e,serverResponse:t,innerException:r})}},1962:function(e,t,r){"use strict";t.nW=t.BQ=t.Q_=void 0;var n=r(5581);Object.defineProperty(t,"Q_",{enumerable:!0,get:function(){return n.createInstance}});var o=r(3851);var i=r(956);var s=r(9370);Object.defineProperty(t,"BQ",{enumerable:!0,get:function(){return s.ErrorReason}});var a=r(86);Object.defineProperty(t,"nW",{enumerable:!0,get:function(){return a.Status}});var c=r(8761);var u=r(2746)},5091:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.abortTimedOutFetch=function(e,t,r){return async n=>{const{cancellationToken:s}=n,a=i(s,t)??new AbortController;n.signal=a.signal;try{return await e(n)}catch(e){throw e?.reason!==o.ErrorReason.TimedOut||void 0!==r&&!r||a.abort(),e}}};const n=r(3851),o=r(9370);const i=(e,t)=>{if(e){const r=t.get(e);if(!r)throw(0,n.createError)(o.ErrorReason.InvalidCancellationToken);return r}}},3657:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.authorize=void 0;const n=r(3851),o=r(9370),i=r(86);t.authorize=(e,t)=>async r=>{const c=r.operationLogger.logStep(i.OperationLogEntryType.AuthDecorate),u=await s(r,t);if(c&&c({result:i.Status[i.Status.OK]}),!u)throw(0,n.createError)(o.ErrorReason.AuthFailed);const l=u.request,f=await e(l),d=await a(f,l,u.resolver);return d?(d.operationLogger.nextStep(i.OperationLogEntryType.Auth,{result:i.Status[f.status]},d,f),e(d)):f};const s=async(e,t)=>{try{return await t(e)}catch(e){throw(0,n.createError)(o.ErrorReason.AuthFailed,void 0,e)}},a=async(e,t,r)=>{const s=t.operationLogger.beginStep(i.OperationLogEntryType.AuthResolve,t);try{const n=r(e,t);return n.then((t=>(s&&t&&s({result:i.Status[e.status]},e),t))),await n}catch(t){throw(0,n.createError)(o.ErrorReason.AuthResolveFailed,e,t)}}},5237:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancellationTracker=void 0;t.cancellationTracker=(e,t)=>async r=>{const{cancellationToken:n}=r;n&&t.set(n,new AbortController);try{return await e(r)}finally{n&&t.delete(n)}}},81:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.catchFailedToFetch=function(e){return async t=>{try{return await e(t)}catch(e){if(e instanceof TypeError&&e.message?.toLowerCase()===s){const r=t.headers&&t.headers.cache;if(r&&-1!==r.indexOf("only-if-cached"))return{status:i.Status.GATEWAY_TIMEOUT};throw(0,n.createError)(o.ErrorReason.RejectHttpError,void 0,e)}if("AbortError"===e.name)throw(0,n.createError)(o.ErrorReason.RequestCancelled);throw e}}};const n=r(3851),o=r(9370),i=r(86),s="failed to fetch"},2182:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.composeSend=void 0;const n=r(5091),o=r(3657),i=r(5237),s=r(7643),a=r(1511),c=r(6658),u=r(8647),l=r(3181);t.composeSend=(e,t,r,f)=>{const{cancellationMap:d}=f;let h=e;return h=(0,n.abortTimedOutFetch)(h,f.cancellationMap,t.abortOnTimeout),r.authResource&&(h=(0,o.authorize)(h,r.authResource)),h=(0,s.composeUrl)(h,r,f),h=(0,a.redirect)(h,t,r),t.rejectHttpError&&(h=(0,c.rejectHttpError)(h)),t.allowedResponses&&(h=(0,u.requireStatus)(h,...t.allowedResponses)),t.retryPolicy&&(h=(0,l.retryWithPolicy)(h,t.retryPolicy,f)),h=(0,i.cancellationTracker)(h,d),h}},7643:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.composeUrl=void 0;const n=r(3851),o=r(9370),i=r(86),s=r(956);t.composeUrl=(e,t,r)=>async a=>{const{baseUrl:c,baseUrlPromise:u}=t,l=a.operationLogger.logStep(i.OperationLogEntryType.BaseUrlResolve),f=c||u&&await(0,s.timed)(u().catch((e=>{throw(0,n.createError)(o.ErrorReason.BaseUrlFailedToResolve,void 0,e)})),r.globalContext,r.configuration.baseUrlResolutionTimeoutInMs,o.ErrorReason.BaseUrlTimeout);try{if(f){const e=!f.endsWith("/")&&a.url.length>0?`${f}/`:f,t=a.url.startsWith("/")?a.url.substring(1):a.url;a.url=new URL(t,e).href}}catch(e){throw(0,n.createError)(o.ErrorReason.InvalidUrl)}return l&&l({result:i.Status[i.Status.OK]}),e(a)}},3403:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTransform=void 0;const n=r(3851),o=r(9370),i=r(86);t.createTransform=e=>async t=>{try{if(e.transformResponse)return await e.transformResponse(t);if(t.status===i.Status.NO_CONTENT)return;const r=e.responseType||function(e){if(e.headers){const t=e.headers["content-type"];if(t){if(-1!==t.indexOf("application/json"))return"json";if(-1!==t.indexOf("text/"))return"text"}if("0"===e.headers["content-length"])return"text"}return}(t)||"json";return await(t.body&&t.body[r]?.())}catch(e){throw"AbortError"===e.name?(0,n.createError)(o.ErrorReason.RequestCancelled):(0,n.createError)(o.ErrorReason.TransformFailed,t,e)}}},2153:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createHealthApi=void 0;const n=r(9370),o=r(2674),i=r(2045);t.createHealthApi=()=>{const e=new Map,t=(t,r)=>e.get(c(t,r))||((t,r)=>{const n={serviceName:t,endpointName:r,isHealthy:void 0},o={responseHistory:[],healthSubject:new i.Subject(n)};return e.set(c(t,r),o),o})(t,r),r=(e,r,n,o)=>{const i=t(r,e);((e,t,r)=>{e.responseHistory.push(t),e.responseHistory.length>r&&e.responseHistory.shift()})(i,n,o.historyLength||5);const s=o.isHealthy([...i.responseHistory]);if(i.healthSubject.value.isHealthy!==s){const t={serviceName:r,endpointName:e,isHealthy:s};i.healthSubject.onNext(t)}};return{trackHealth:(e,t,n)=>u(e,r,t,s(n)),observeEndpointHealth:(e,r)=>{if(!e||!r)return;return t(e,r).healthSubject.observable},getEndpointHealth:(t,r)=>a(t,r,e),dumpState:()=>f(e)}};const s=e=>({...l,...e}),a=(e,t,r)=>{const n=r.get(c(e,t))?.healthSubject.value;return n&&{...n}},c=(e,t)=>`${e}_${t}`,u=(e,t,r,n)=>async o=>e(o).then((e=>(t(o.apiName||"",r,e.status,n),e))).catch((e=>{throw t(o.apiName||"",r,e.reason,n),e})),l={isHealthy:e=>{if(e&&e.length>0){const t=e[e.length-1];if("number"!=typeof t&&t!==n.ErrorReason.RequestCancelled)return!1}return!0},historyLength:5};const f=e=>{let t="";return e.forEach((e=>{t=`${t}${JSON.stringify(e.healthSubject.value)}`})),t?(0,o.unleakString)(t):""}},3974:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createNetworkMonitor=void 0;const n=r(9370),o=r(86),i=r(2045),s=!0,a=new i.Subject(s);t.createNetworkMonitor=()=>{const e=e=>a.onNext(e);return{networkMonitor:{processResponse:t=>{void 0!==t.status&&t.status!==o.Status.NOT_MODIFIED&&t.status!==o.Status.GATEWAY_TIMEOUT&&e(s)},processResponseError:t=>{t&&(t.reason===n.ErrorReason.RejectHttpError?e(false):t.serverResponse&&e(s))}},networkState:{observeIsOnline:()=>a.observable,isOnline:()=>a.value}}}},3616:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.rawSendConstructor=void 0;const o=n(r(6401)),i=r(3851),s=r(9370),a=r(956);t.rawSendConstructor=(e,t)=>async r=>c(r,e,t);const c=({url:e,method:t,body:r,headers:n,credentials:c,timeout:u,signal:l},f,d)=>{if(l?.aborted)throw(0,i.createError)(s.ErrorReason.RequestCancelled);return(0,a.timed)((0,o.default)(e,{method:t,headers:n&&new Headers(n),body:r,signal:l,credentials:c}),f,u??d.defaultRequestTimeoutInMs).then((e=>{const t={};return e.headers?.forEach(((e,r)=>t[r]=e)),{status:e.status,headers:t,body:e,url:e.url}}))}},1511:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.redirect=void 0;const n=r(3851),o=r(9370),i=r(86);function s(e,t=i.Status.NOT_FOUND){return Array.isArray(t)?t.some((t=>a(e,t))):a(e,t)}function a(e,t){return"string"==typeof t?new RegExp(t.replace(/x/gi,"\\d")).test(e.toString()):e===t}t.redirect=(e,t,r)=>{if(!t.redirectPolicy)return e;const{maxRedirects:a,useAbsoluteRedirect:c,headers:u,redirectOn:l,onRedirect:f}=t.redirectPolicy;return async t=>{const d={...t,headers:{...t.headers,...u}};let h=await e(d);for(let u=0;;u++){const{status:p,headers:{location:y}}=h;if(!(u<a&&s(p,l)))return h;try{let e;if(f?e=f(y,p):y&&(e=new URL(y)),!e)return h;c?(r.baseUrl=e.origin,d.url=e.pathname):(d.url=t.url,r.baseUrl=e.href)}catch(e){throw(0,n.createError)(o.ErrorReason.InvalidUrl,void 0,e)}d.operationLogger.nextStep(i.OperationLogEntryType.Redirect,{result:i.Status[h.status]},d,h),h=await e(d)}}}},6658:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rejectHttpError=function(e){return async t=>{const r=await e(t);if(r.status>=i.Status.BAD_REQUEST)throw(0,n.createError)(o.ErrorReason.RequireStatusFailed,r,[i.Status[r.status]]);return r}};const n=r(3851),o=r(9370),i=r(86)},8647:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requireStatus=function(e,...t){return r=>e(r).then((e=>{if(s(e.status,t))return e;const r=[i.Status[e.status]];throw(0,n.createError)(o.ErrorReason.RequireStatusFailed,e,r)}))};const n=r(3851),o=r(9370),i=r(86);const s=(e,t)=>t.indexOf(e)>-1||t.filter(a).map((e=>new RegExp(e.replace(/x/gi,"\\d")))).some((t=>t.test(e.toString())));function a(e){return"string"==typeof e}},3181:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.retryWithPolicy=function(e,t,r){const n=new Map;return o=>s(e,t,n,r)(o)};const n=r(9370),o=r(86),i=r(956);const s=(e,t,r,{globalContext:s})=>async c=>{let u=await a(e)(c);for(let l=0;;l++){const{response:f,error:d}=u,h=f?.status,p=h||d?.reason||n.ErrorReason.FailedToFetch,y=f?.headers,b=r.get(p)||0;if(r.set(p,b+1),!t.shouldRetry(l,p,r,y)){if(d)throw d;return u.response}{const r=t.nextDelay(l,y,p),n=h&&o.Status[h]||void 0;c.operationLogger.nextStep(o.OperationLogEntryType.RetryDelay,{result:n,resultError:d},void 0,f),await(0,i.sleep)(r,s),c.operationLogger.nextStep(o.OperationLogEntryType.Retry,{result:o.Status[o.Status.OK]},c),u=await a(e)(c)}}},a=e=>async t=>{try{return{response:await e(t)}}catch(e){return{response:e.serverResponse,error:e}}}},6507:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.throttleFactory=void 0;const n=r(86),o=r(956);t.throttleFactory=(e,t,r)=>{let i,s;return t.then((e=>{if(e.throttlePolicy){s=e.throttlePolicy;const t=s?.throttleKey;t?(i=r.get(t)||[],r.has(t)||r.set(t,i)):i=[]}})),t=>s?r=>async function r(a){const c=function(e,t){const{maxPerThrottleInterval:r,throttleInterval:n}=t,o=Date.now()-n;let i=e.length-1;for(;i>=0&&o<e[i];)i--;e.splice(0,i);const s=e.length-r;return s>=0?e[s]-o:0}(i,s);if(!c)return function(e){return i.push(Date.now()),t(e)}(a);const u=a.operationLogger.logStep(n.OperationLogEntryType.Throttle);return await(0,o.sleep)(c,e),u&&u({result:n.Status[n.Status.OK]}),r(a)}(r):t}},956:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timed=function(e,t,r,i=o.ErrorReason.TimedOut){let s;const a=new Promise((e=>{s=t.setTimeout(e,r)}));return Promise.race([e,a.then((()=>{throw(0,n.createError)(i)}))]).then((e=>(t.clearTimeout(s),e)))},t.sleep=function(e,t){return new Promise(((r,i)=>{if(e<0)i((0,n.createError)(o.ErrorReason.InvalidParameters));else{let n=0;n=t.setTimeout((()=>{t.clearTimeout(n),r()}),e)}}))};const n=r(3851),o=r(9370)},7051:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trackNetworkState=void 0;t.trackNetworkState=(e,t)=>async r=>t(r).then((t=>(e.processResponse(t),t))).catch((t=>{throw e.processResponseError(t),t}))},9370:function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorReason=void 0,function(e){e.AuthFailed="AuthFailed",e.AuthResolveFailed="AuthResolveFailed",e.BaseUrlFailedToResolve="BaseUrlFailedToResolve",e.BaseUrlTimeout="BaseUrlTimeout",e.CustomTelemetryFailed="CustomTelemetryFailed",e.FailedToFetch="FailedToFetch",e.InvalidCancellationToken="InvalidCancellationToken",e.InvalidParameters="Invalid pararameters",e.InvalidUrl="InvalidUrl",e.ModelFailedToInitialize="ModelFailedToInitialize",e.ModelTimeOut="ModelTimeOut",e.NotImplemented="NotImplemented",e.RejectHttpError="RejectHttpError",e.RequestCancelled="RequestCancelled",e.RequireStatusFailed="RequireStatusFailed",e.TimedOut="TimedOut",e.TransformFailed="TransformFailed"}(r||(t.ErrorReason=r={}))},86:function(e,t){"use strict";var r,n,o;Object.defineProperty(t,"__esModule",{value:!0}),t.OperationLogEntryType=t.StatusXX=t.Status=void 0,function(e){e[e.OK=200]="OK",e[e.CREATED=201]="CREATED",e[e.ACCEPTED=202]="ACCEPTED",e[e.NO_CONTENT=204]="NO_CONTENT",e[e.PARTIAL_CONTENT=206]="PARTIAL_CONTENT",e[e.MULTI_STATUS=207]="MULTI_STATUS",e[e.NOT_MODIFIED=304]="NOT_MODIFIED",e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.NOT_AUTHORIZED=401]="NOT_AUTHORIZED",e[e.PAYMENT_REQUIRED=402]="PAYMENT_REQUIRED",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.NOT_FOUND=404]="NOT_FOUND",e[e.NOT_ALLOWED=405]="NOT_ALLOWED",e[e.NOT_ACCEPTABLE=406]="NOT_ACCEPTABLE",e[e.PROXY_AUTHENTICATION_REQUIRED=407]="PROXY_AUTHENTICATION_REQUIRED",e[e.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",e[e.CONFLICT=409]="CONFLICT",e[e.GONE=410]="GONE",e[e.LENGTH_REQUIRED=411]="LENGTH_REQUIRED",e[e.PRECONDITION_FAILED=412]="PRECONDITION_FAILED",e[e.REQUEST_ENTITY_TOO_LARGE=413]="REQUEST_ENTITY_TOO_LARGE",e[e.UNSUPPORTED_MEDIA_TYPE=415]="UNSUPPORTED_MEDIA_TYPE",e[e.REQUEST_RANGE_NOT_SATISFIABLE=416]="REQUEST_RANGE_NOT_SATISFIABLE",e[e.EXPECTATION_FAILED=417]="EXPECTATION_FAILED",e[e.UNPROCESSABLE_ENTITY=422]="UNPROCESSABLE_ENTITY",e[e.THROTTLED=429]="THROTTLED",e[e.ENCRYPTION_ERROR=463]="ENCRYPTION_ERROR",e[e.REQUEST_TERMINATED=487]="REQUEST_TERMINATED",e[e.SERVER_ERROR=500]="SERVER_ERROR",e[e.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",e[e.BAD_GATEWAY=502]="BAD_GATEWAY",e[e.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",e[e.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT",e[e.INSUFFICIENT_STORAGE=507]="INSUFFICIENT_STORAGE",e[e.BANDWIDTH_LIMIT_EXCEEDED=509]="BANDWIDTH_LIMIT_EXCEEDED",e[e.SERVER_TIMEOUT=599]="SERVER_TIMEOUT"}(r||(t.Status=r={})),function(e){e.HTTP_2XX="2xx",e.HTTP_4XX="4xx",e.HTTP_5XX="5xx"}(n||(t.StatusXX=n={})),function(e){e.Initial="Initial",e.Auth="Auth",e.AuthDecorate="AuthDecorate",e.AuthResolve="AuthResolve",e.BaseUrlResolve="BaseUrlResolve",e.Retry="Retry",e.RetryDelay="RetryDelay",e.Redirect="Redirect",e.Throttle="Throttle"}(o||(t.OperationLogEntryType=o={}))},8761:function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.HealthStatus=void 0,function(e){e.HEALTHY="healthy",e.UNHEALTHY="unhealthy",e.UNKNOWN="unknown"}(r||(t.HealthStatus=r={}))},2674:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unleakString=void 0,t.safeJsonStringify=function(e,t){const r=new WeakSet;return JSON.stringify(e,((e,t)=>{if(!r.has(t)){if(t&&"object"==typeof t){if(r.add(t),t instanceof Map||t instanceof Set)return Array.from(t);if(t instanceof Error)return`${t.name}: ${t.message}`;if(t.constructor&&t.constructor!==Object&&t.constructor!==Array||t.prototype)return}return t}}),t)};t.unleakString=e=>null==e||0===e.length?e:` ${e}`.substr(1)},2045:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.Subject=void 0;const a=s(r(9434));t.Subject=class{observable$;observedValue;subscriptions;constructor(e){this.subscriptions=new Set,this.observedValue=e,this.observable$=new a.Observable((e=>(this.subscriptions.add(e),()=>{this.subscriptions.has(e)&&this.subscriptions.delete(e)})))}get observable(){return this.observable$}subscribe(e){return this.observable$.subscribe(e)}onNext(e){this.observedValue=e,this.subscriptions.forEach((t=>{t.next(e)}))}onComplete(){this.subscriptions.forEach((e=>{e.closed||e.complete()}))}onError(e){this.subscriptions.forEach((t=>{t.error(e)}))}get value(){return this.observedValue}}},3011:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOperationLogger=void 0;const n=r(86);function o(e,t,r){if(!t)return;const n=r?new URL(r.url).hostname:"";return{name:t.apiName||"",dateTime:e,method:t.method,hostname:n,requestHeaders:t.headers||{},responseHeaders:r?.headers||{},status:r?.status,performance:i(r?.url),authPerformanceLogs:t.authPerformanceLogs||{}}}function i(e){if(e){const t=performance.getEntriesByName(e);if(t.length>0&&"resource"===t[t.length-1].entryType){return t[t.length-1]}}}t.createOperationLogger=e=>{const t=[];let r;const i=(e,r,n)=>{const i=new Date;return(s,a,c)=>{t.push({type:e,duration:s-r,result:a,request:o(i,n,c)})}},s=(e,t)=>{const n=performance.now();return(o,s)=>{r(n,o,s),r=i(e,n,t)}};return r=i(n.OperationLogEntryType.Initial,performance.now(),e),{nextStep:(e,t,r,n)=>{s(e,r)(t,n)},beginStep:s,logStep:(e,t,r)=>{const n=i(e,performance.now(),t);return e=>n(performance.now(),e,r)},complete:(e,n)=>(r(performance.now(),e,n),t)}}},2746:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.withClientInfo=function(e,t){return t?(...r)=>{const n=e(...r);return{...n,headers:{...t,...n.headers}}}:e}},3216:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version=t.validate=t.v7=t.v6ToV1=t.v6=t.v5=t.v4=t.v3=t.v1ToV6=t.v1=t.stringify=t.parse=t.NIL=t.MAX=void 0;var n=r(4370);Object.defineProperty(t,"MAX",{enumerable:!0,get:function(){return n.default}});var o=r(1851);Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return o.default}});var i=r(2083);Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return i.default}});var s=r(6045);Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return s.default}});var a=r(527);Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return a.default}});var c=r(1178);Object.defineProperty(t,"v1ToV6",{enumerable:!0,get:function(){return c.default}});var u=r(5809);Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return u.default}});var l=r(8788);Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return l.default}});var f=r(3883);Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return f.default}});var d=r(2670);Object.defineProperty(t,"v6",{enumerable:!0,get:function(){return d.default}});var h=r(4678);Object.defineProperty(t,"v6ToV1",{enumerable:!0,get:function(){return h.default}});var p=r(7021);Object.defineProperty(t,"v7",{enumerable:!0,get:function(){return p.default}});var y=r(7256);Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return y.default}});var b=r(3628);Object.defineProperty(t,"version",{enumerable:!0,get:function(){return b.default}})},4370:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="ffffffff-ffff-ffff-ffff-ffffffffffff"},4344:function(e,t){"use strict";function r(e){return 14+(e+64>>>9<<4)+1}function n(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function o(e,t,r,o,i,s){return n((a=n(n(t,e),n(o,s)))<<(c=i)|a>>>32-c,r);var a,c}function i(e,t,r,n,i,s,a){return o(t&r|~t&n,e,t,i,s,a)}function s(e,t,r,n,i,s,a){return o(t&n|r&~n,e,t,i,s,a)}function a(e,t,r,n,i,s,a){return o(t^r^n,e,t,i,s,a)}function c(e,t,r,n,i,s,a){return o(r^(t|~n),e,t,i,s,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(e){const t=new Uint8Array(4*e.length);for(let r=0;r<4*e.length;r++)t[r]=e[r>>2]>>>r%4*8&255;return t}(function(e,t){const o=new Uint32Array(r(t)).fill(0);o.set(e),o[t>>5]|=128<<t%32,o[o.length-1]=t,e=o;let u=1732584193,l=-271733879,f=-1732584194,d=271733878;for(let t=0;t<e.length;t+=16){const r=u,o=l,h=f,p=d;u=i(u,l,f,d,e[t],7,-680876936),d=i(d,u,l,f,e[t+1],12,-389564586),f=i(f,d,u,l,e[t+2],17,606105819),l=i(l,f,d,u,e[t+3],22,-1044525330),u=i(u,l,f,d,e[t+4],7,-176418897),d=i(d,u,l,f,e[t+5],12,1200080426),f=i(f,d,u,l,e[t+6],17,-1473231341),l=i(l,f,d,u,e[t+7],22,-45705983),u=i(u,l,f,d,e[t+8],7,1770035416),d=i(d,u,l,f,e[t+9],12,-1958414417),f=i(f,d,u,l,e[t+10],17,-42063),l=i(l,f,d,u,e[t+11],22,-1990404162),u=i(u,l,f,d,e[t+12],7,1804603682),d=i(d,u,l,f,e[t+13],12,-40341101),f=i(f,d,u,l,e[t+14],17,-1502002290),l=i(l,f,d,u,e[t+15],22,1236535329),u=s(u,l,f,d,e[t+1],5,-165796510),d=s(d,u,l,f,e[t+6],9,-1069501632),f=s(f,d,u,l,e[t+11],14,643717713),l=s(l,f,d,u,e[t],20,-373897302),u=s(u,l,f,d,e[t+5],5,-701558691),d=s(d,u,l,f,e[t+10],9,38016083),f=s(f,d,u,l,e[t+15],14,-660478335),l=s(l,f,d,u,e[t+4],20,-405537848),u=s(u,l,f,d,e[t+9],5,568446438),d=s(d,u,l,f,e[t+14],9,-1019803690),f=s(f,d,u,l,e[t+3],14,-187363961),l=s(l,f,d,u,e[t+8],20,1163531501),u=s(u,l,f,d,e[t+13],5,-1444681467),d=s(d,u,l,f,e[t+2],9,-51403784),f=s(f,d,u,l,e[t+7],14,1735328473),l=s(l,f,d,u,e[t+12],20,-1926607734),u=a(u,l,f,d,e[t+5],4,-378558),d=a(d,u,l,f,e[t+8],11,-2022574463),f=a(f,d,u,l,e[t+11],16,1839030562),l=a(l,f,d,u,e[t+14],23,-35309556),u=a(u,l,f,d,e[t+1],4,-1530992060),d=a(d,u,l,f,e[t+4],11,1272893353),f=a(f,d,u,l,e[t+7],16,-155497632),l=a(l,f,d,u,e[t+10],23,-1094730640),u=a(u,l,f,d,e[t+13],4,681279174),d=a(d,u,l,f,e[t],11,-358537222),f=a(f,d,u,l,e[t+3],16,-722521979),l=a(l,f,d,u,e[t+6],23,76029189),u=a(u,l,f,d,e[t+9],4,-640364487),d=a(d,u,l,f,e[t+12],11,-421815835),f=a(f,d,u,l,e[t+15],16,530742520),l=a(l,f,d,u,e[t+2],23,-995338651),u=c(u,l,f,d,e[t],6,-198630844),d=c(d,u,l,f,e[t+7],10,1126891415),f=c(f,d,u,l,e[t+14],15,-1416354905),l=c(l,f,d,u,e[t+5],21,-57434055),u=c(u,l,f,d,e[t+12],6,1700485571),d=c(d,u,l,f,e[t+3],10,-1894986606),f=c(f,d,u,l,e[t+10],15,-1051523),l=c(l,f,d,u,e[t+1],21,-2054922799),u=c(u,l,f,d,e[t+8],6,1873313359),d=c(d,u,l,f,e[t+15],10,-30611744),f=c(f,d,u,l,e[t+6],15,-1560198380),l=c(l,f,d,u,e[t+13],21,1309151649),u=c(u,l,f,d,e[t+4],6,-145523070),d=c(d,u,l,f,e[t+11],10,-1120210379),f=c(f,d,u,l,e[t+2],15,718787259),l=c(l,f,d,u,e[t+9],21,-343485551),u=n(u,r),l=n(l,o),f=n(f,h),d=n(d,p)}return Uint32Array.of(u,l,f,d)}(function(e){if(0===e.length)return new Uint32Array;const t=new Uint32Array(r(8*e.length)).fill(0);for(let r=0;r<e.length;r++)t[r>>2]|=(255&e[r])<<r%4*8;return t}(e),8*e.length))}},5693:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);t.default={randomUUID:r}},1851:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="00000000-0000-0000-0000-000000000000"},2083:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(7256);t.default=function(e){if(!(0,n.default)(e))throw TypeError("Invalid UUID");let t;return Uint8Array.of((t=parseInt(e.slice(0,8),16))>>>24,t>>>16&255,t>>>8&255,255&t,(t=parseInt(e.slice(9,13),16))>>>8,255&t,(t=parseInt(e.slice(14,18),16))>>>8,255&t,(t=parseInt(e.slice(19,23),16))>>>8,255&t,(t=parseInt(e.slice(24,36),16))/1099511627776&255,t/4294967296&255,t>>>24&255,t>>>16&255,t>>>8&255,255&t)}},9047:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i},749:function(e,t){"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0});const n=new Uint8Array(16);t.default=function(){if(!r){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");r=crypto.getRandomValues.bind(crypto)}return r(n)}},6059:function(e,t){"use strict";function r(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:case 3:return t^r^n;case 2:return t&r^t&n^r&n}}function n(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=[1518500249,1859775393,2400959708,3395469782],o=[1732584193,4023233417,2562383102,271733878,3285377520],i=new Uint8Array(e.length+1);i.set(e),i[e.length]=128;const s=(e=i).length/4+2,a=Math.ceil(s/16),c=new Array(a);for(let t=0;t<a;++t){const r=new Uint32Array(16);for(let n=0;n<16;++n)r[n]=e[64*t+4*n]<<24|e[64*t+4*n+1]<<16|e[64*t+4*n+2]<<8|e[64*t+4*n+3];c[t]=r}c[a-1][14]=8*(e.length-1)/Math.pow(2,32),c[a-1][14]=Math.floor(c[a-1][14]),c[a-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<a;++e){const i=new Uint32Array(80);for(let t=0;t<16;++t)i[t]=c[e][t];for(let e=16;e<80;++e)i[e]=n(i[e-3]^i[e-8]^i[e-14]^i[e-16],1);let s=o[0],a=o[1],u=o[2],l=o[3],f=o[4];for(let e=0;e<80;++e){const o=Math.floor(e/20),c=n(s,5)+r(o,a,u,l)+f+t[o]+i[e]>>>0;f=l,l=u,u=n(a,30)>>>0,a=s,s=c}o[0]=o[0]+s>>>0,o[1]=o[1]+a>>>0,o[2]=o[2]+u>>>0,o[3]=o[3]+l>>>0,o[4]=o[4]+f>>>0}return Uint8Array.of(o[0]>>24,o[0]>>16,o[0]>>8,o[0],o[1]>>24,o[1]>>16,o[1]>>8,o[1],o[2]>>24,o[2]>>16,o[2]>>8,o[2],o[3]>>24,o[3]>>16,o[3]>>8,o[3],o[4]>>24,o[4]>>16,o[4]>>8,o[4])}},6045:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unsafeStringify=void 0;const n=r(7256),o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));function i(e,t=0){return(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase()}t.unsafeStringify=i,t.default=function(e,t=0){const r=i(e,t);if(!(0,n.default)(r))throw TypeError("Stringified UUID is invalid");return r}},527:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateV1State=void 0;const n=r(749),o=r(6045),i={};function s(e,t,r){return e.msecs??=-1/0,e.nsecs??=0,t===e.msecs?(e.nsecs++,e.nsecs>=1e4&&(e.node=void 0,e.nsecs=0)):t>e.msecs?e.nsecs=0:t<e.msecs&&(e.node=void 0),e.node||(e.node=r.slice(10,16),e.node[0]|=1,e.clockseq=16383&(r[8]<<8|r[9])),e.msecs=t,e}function a(e,t,r,n,o,i,s=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(i){if(s<0||s+16>i.length)throw new RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`)}else i=new Uint8Array(16),s=0;t??=Date.now(),r??=0,n??=16383&(e[8]<<8|e[9]),o??=e.slice(10,16);const a=(1e4*(268435455&(t+=122192928e5))+r)%4294967296;i[s++]=a>>>24&255,i[s++]=a>>>16&255,i[s++]=a>>>8&255,i[s++]=255&a;const c=t/4294967296*1e4&268435455;i[s++]=c>>>8&255,i[s++]=255&c,i[s++]=c>>>24&15|16,i[s++]=c>>>16&255,i[s++]=n>>>8|128,i[s++]=255&n;for(let e=0;e<6;++e)i[s++]=o[e];return i}t.updateV1State=s,t.default=function(e,t,r){let c;const u=e?._v6??!1;if(e){const t=Object.keys(e);1===t.length&&"_v6"===t[0]&&(e=void 0)}if(e)c=a(e.random??e.rng?.()??(0,n.default)(),e.msecs,e.nsecs,e.clockseq,e.node,t,r);else{const e=Date.now(),o=(0,n.default)();s(i,e,o),c=a(o,i.msecs,i.nsecs,u?void 0:i.clockseq,u?void 0:i.node,t,r)}return t??(0,o.unsafeStringify)(c)}},1178:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2083),o=r(6045);t.default=function(e){const t=function(e){return Uint8Array.of((15&e[6])<<4|e[7]>>4&15,(15&e[7])<<4|(240&e[4])>>4,(15&e[4])<<4|(240&e[5])>>4,(15&e[5])<<4|(240&e[0])>>4,(15&e[0])<<4|(240&e[1])>>4,(15&e[1])<<4|(240&e[2])>>4,96|15&e[2],e[3],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}("string"==typeof e?(0,n.default)(e):e);return"string"==typeof e?(0,o.unsafeStringify)(t):t}},5809:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0;const n=r(4344),o=r(7058);var i=r(7058);function s(e,t,r,i){return(0,o.default)(48,n.default,e,t,r,i)}Object.defineProperty(t,"DNS",{enumerable:!0,get:function(){return i.DNS}}),Object.defineProperty(t,"URL",{enumerable:!0,get:function(){return i.URL}}),s.DNS=o.DNS,s.URL=o.URL,t.default=s},7058:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=t.stringToBytes=void 0;const n=r(2083),o=r(6045);function i(e){e=unescape(encodeURIComponent(e));const t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return t}t.stringToBytes=i,t.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",t.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",t.default=function(e,t,r,s,a,c){const u="string"==typeof r?i(r):r,l="string"==typeof s?(0,n.default)(s):s;if("string"==typeof s&&(s=(0,n.default)(s)),16!==s?.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let f=new Uint8Array(16+u.length);if(f.set(l),f.set(u,l.length),f=t(f),f[6]=15&f[6]|e,f[8]=63&f[8]|128,a){c=c||0;for(let e=0;e<16;++e)a[c+e]=f[e];return a}return(0,o.unsafeStringify)(f)}},8788:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5693),o=r(749),i=r(6045);t.default=function(e,t,r){if(n.default.randomUUID&&!t&&!e)return n.default.randomUUID();const s=(e=e||{}).random??e.rng?.()??(0,o.default)();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){if((r=r||0)<0||r+16>t.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=s[e];return t}return(0,i.unsafeStringify)(s)}},3883:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0;const n=r(6059),o=r(7058);var i=r(7058);function s(e,t,r,i){return(0,o.default)(80,n.default,e,t,r,i)}Object.defineProperty(t,"DNS",{enumerable:!0,get:function(){return i.DNS}}),Object.defineProperty(t,"URL",{enumerable:!0,get:function(){return i.URL}}),s.DNS=o.DNS,s.URL=o.URL,t.default=s},2670:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6045),o=r(527),i=r(1178);t.default=function(e,t,r){e??={},r??=0;let s=(0,o.default)({...e,_v6:!0},new Uint8Array(16));if(s=(0,i.default)(s),t){for(let e=0;e<16;e++)t[r+e]=s[e];return t}return(0,n.unsafeStringify)(s)}},4678:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2083),o=r(6045);t.default=function(e){const t=function(e){return Uint8Array.of((15&e[3])<<4|e[4]>>4&15,(15&e[4])<<4|(240&e[5])>>4,(15&e[5])<<4|15&e[6],e[7],(15&e[1])<<4|(240&e[2])>>4,(15&e[2])<<4|(240&e[3])>>4,16|(240&e[0])>>4,(15&e[0])<<4|(240&e[1])>>4,e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}("string"==typeof e?(0,n.default)(e):e);return"string"==typeof e?(0,o.unsafeStringify)(t):t}},7021:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateV7State=void 0;const n=r(749),o=r(6045),i={};function s(e,t,r){return e.msecs??=-1/0,e.seq??=0,t>e.msecs?(e.seq=r[6]<<23|r[7]<<16|r[8]<<8|r[9],e.msecs=t):(e.seq=e.seq+1|0,0===e.seq&&e.msecs++),e}function a(e,t,r,n,o=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(n){if(o<0||o+16>n.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`)}else n=new Uint8Array(16),o=0;return t??=Date.now(),r??=127*e[6]<<24|e[7]<<16|e[8]<<8|e[9],n[o++]=t/1099511627776&255,n[o++]=t/4294967296&255,n[o++]=t/16777216&255,n[o++]=t/65536&255,n[o++]=t/256&255,n[o++]=255&t,n[o++]=112|r>>>28&15,n[o++]=r>>>20&255,n[o++]=128|r>>>14&63,n[o++]=r>>>6&255,n[o++]=r<<2&255|3&e[10],n[o++]=e[11],n[o++]=e[12],n[o++]=e[13],n[o++]=e[14],n[o++]=e[15],n}t.updateV7State=s,t.default=function(e,t,r){let c;if(e)c=a(e.random??e.rng?.()??(0,n.default)(),e.msecs,e.seq,t,r);else{const e=Date.now(),o=(0,n.default)();s(i,e,o),c=a(o,i.msecs,i.seq,t,r)}return t??(0,o.unsafeStringify)(c)}},7256:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(9047);t.default=function(e){return"string"==typeof e&&n.default.test(e)}},3628:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(7256);t.default=function(e){if(!(0,n.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},9434:function(e,t,r){"use strict";function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}r.r(t),r.d(t,{Observable:function(){return O}});var a=function(){return"function"==typeof Symbol},c=function(e){return a()&&Boolean(Symbol[e])},u=function(e){return c(e)?Symbol[e]:"@@"+e};a()&&!c("observable")&&(Symbol.observable=Symbol("observable"));var l=u("iterator"),f=u("observable"),d=u("species");function h(e,t){var r=e[t];if(null!=r){if("function"!=typeof r)throw new TypeError(r+" is not a function");return r}}function p(e){var t=e.constructor;return void 0!==t&&null===(t=t[d])&&(t=void 0),void 0!==t?t:O}function y(e){return e instanceof O}function b(e){b.log?b.log(e):setTimeout((function(){throw e}))}function g(e){Promise.resolve().then((function(){try{e()}catch(e){b(e)}}))}function m(e){var t=e._cleanup;if(void 0!==t&&(e._cleanup=void 0,t))try{if("function"==typeof t)t();else{var r=h(t,"unsubscribe");r&&r.call(t)}}catch(e){b(e)}}function v(e){e._observer=void 0,e._queue=void 0,e._state="closed"}function E(e,t,r){e._state="running";var n=e._observer;try{var o=h(n,t);switch(t){case"next":o&&o.call(n,r);break;case"error":if(v(e),!o)throw r;o.call(n,r);break;case"complete":v(e),o&&o.call(n)}}catch(e){b(e)}"closed"===e._state?m(e):"running"===e._state&&(e._state="ready")}function w(e,t,r){if("closed"!==e._state){if("buffering"!==e._state)return"ready"!==e._state?(e._state="buffering",e._queue=[{type:t,value:r}],void g((function(){return function(e){var t=e._queue;if(t){e._queue=void 0,e._state="ready";for(var r=0;r<t.length&&(E(e,t[r].type,t[r].value),"closed"!==e._state);++r);}}(e)}))):void E(e,t,r);e._queue.push({type:t,value:r})}}var T=function(){function e(e,t){this._cleanup=void 0,this._observer=e,this._queue=void 0,this._state="initializing";var r=new _(this);try{this._cleanup=t.call(void 0,r)}catch(e){r.error(e)}"initializing"===this._state&&(this._state="ready")}return e.prototype.unsubscribe=function(){"closed"!==this._state&&(v(this),m(this))},s(e,[{key:"closed",get:function(){return"closed"===this._state}}]),e}(),_=function(){function e(e){this._subscription=e}var t=e.prototype;return t.next=function(e){w(this._subscription,"next",e)},t.error=function(e){w(this._subscription,"error",e)},t.complete=function(){w(this._subscription,"complete")},s(e,[{key:"closed",get:function(){return"closed"===this._subscription._state}}]),e}(),O=function(){function e(t){if(!(this instanceof e))throw new TypeError("Observable cannot be called as a function");if("function"!=typeof t)throw new TypeError("Observable initializer must be a function");this._subscriber=t}var t=e.prototype;return t.subscribe=function(e){return"object"==typeof e&&null!==e||(e={next:e,error:arguments[1],complete:arguments[2]}),new T(e,this._subscriber)},t.forEach=function(e){var t=this;return new Promise((function(r,n){if("function"==typeof e)var o=t.subscribe({next:function(t){try{e(t,i)}catch(e){n(e),o.unsubscribe()}},error:n,complete:r});else n(new TypeError(e+" is not a function"));function i(){o.unsubscribe(),r()}}))},t.map=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(p(this))((function(r){return t.subscribe({next:function(t){try{t=e(t)}catch(e){return r.error(e)}r.next(t)},error:function(e){r.error(e)},complete:function(){r.complete()}})}))},t.filter=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(p(this))((function(r){return t.subscribe({next:function(t){try{if(!e(t))return}catch(e){return r.error(e)}r.next(t)},error:function(e){r.error(e)},complete:function(){r.complete()}})}))},t.reduce=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var r=p(this),n=arguments.length>1,o=!1,i=arguments[1];return new r((function(r){return t.subscribe({next:function(t){var s=!o;if(o=!0,!s||n)try{i=e(i,t)}catch(e){return r.error(e)}else i=t},error:function(e){r.error(e)},complete:function(){if(!o&&!n)return r.error(new TypeError("Cannot reduce an empty sequence"));r.next(i),r.complete()}})}))},t.concat=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var o=p(this);return new o((function(t){var n,i=0;return function e(s){n=s.subscribe({next:function(e){t.next(e)},error:function(e){t.error(e)},complete:function(){i===r.length?(n=void 0,t.complete()):e(o.from(r[i++]))}})}(e),function(){n&&(n.unsubscribe(),n=void 0)}}))},t.flatMap=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var r=p(this);return new r((function(n){var o=[],i=t.subscribe({next:function(t){if(e)try{t=e(t)}catch(e){return n.error(e)}var i=r.from(t).subscribe({next:function(e){n.next(e)},error:function(e){n.error(e)},complete:function(){var e=o.indexOf(i);e>=0&&o.splice(e,1),s()}});o.push(i)},error:function(e){n.error(e)},complete:function(){s()}});function s(){i.closed&&0===o.length&&n.complete()}return function(){o.forEach((function(e){return e.unsubscribe()})),i.unsubscribe()}}))},t[f]=function(){return this},e.from=function(t){var r="function"==typeof this?this:e;if(null==t)throw new TypeError(t+" is not an object");var o=h(t,f);if(o){var i=o.call(t);if(Object(i)!==i)throw new TypeError(i+" is not an object");return y(i)&&i.constructor===r?i:new r((function(e){return i.subscribe(e)}))}if(c("iterator")&&(o=h(t,l)))return new r((function(e){g((function(){if(!e.closed){for(var r,i=n(o.call(t));!(r=i()).done;){var s=r.value;if(e.next(s),e.closed)return}e.complete()}}))}));if(Array.isArray(t))return new r((function(e){g((function(){if(!e.closed){for(var r=0;r<t.length;++r)if(e.next(t[r]),e.closed)return;e.complete()}}))}));throw new TypeError(t+" is not observable")},e.of=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return new("function"==typeof this?this:e)((function(e){g((function(){if(!e.closed){for(var t=0;t<r.length;++t)if(e.next(r[t]),e.closed)return;e.complete()}}))}))},s(e,null,[{key:d,get:function(){return this}}]),e}();a()&&Object.defineProperty(O,Symbol("extensions"),{value:{symbol:f,hostReportError:b},configurable:!0})}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){"use strict";function e(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var t=r(1962);var n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let o;const i=new Uint8Array(16);const s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));function a(e,t=0){return(s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]).toLowerCase()}var c,u,l,f,d,h=function(e,t,r){if(n.randomUUID&&!t&&!e)return n.randomUUID();const s=(e=e||{}).random??e.rng?.()??function(){if(!o){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");o=crypto.getRandomValues.bind(crypto)}return o(i)}();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){if((r=r||0)<0||r+16>t.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=s[e];return t}return a(s)};!function(e){e[e.Manual=0]="Manual",e[e.WhenExpired=1]="WhenExpired"}(c||(c={})),function(e){e[e.Success=0]="Success",e[e.Success_NoChanges=1]="Success_NoChanges",e[e.Abandoned_ClientVeryActive=2]="Abandoned_ClientVeryActive",e[e.Abandoned_NoNetwork=3]="Abandoned_NoNetwork",e[e.Error_TimedOut=4]="Error_TimedOut",e[e.Error_TransformFailed=5]="Error_TransformFailed",e[e.Error_BrowserError=6]="Error_BrowserError",e[e.Error_Unknown=7]="Error_Unknown",e[e.NotStarted=8]="NotStarted"}(u||(u={})),function(e){e[e.Valid=0]="Valid",e[e.Invalid=1]="Invalid",e[e.Expired=2]="Expired",e[e.NoData=3]="NoData",e[e.NoCache=4]="NoCache"}(l||(l={})),function(e){e.Filters="Filters",e.None="None",e.ConsumerKey="ConsumerKey"}(f||(f={})),function(e){e.OnExpiry="OnExpiry",e.Never="Never"}(d||(d={}));const p="c72ea287-ed77-4fa6-a480-3712406c367e";function y(e,t,r){const{strategy:n,excludeFilters:o,consumerKey:i}=t;let s=`ecs.cache.${e}`;switch(n){case f.ConsumerKey:if(!i)throw new Error("Cannot generate key using PartitionStrategy.ConsumerKey if consumerKey is not provided");s=`${i}`;break;case f.Filters:{if(!r)throw new Error("Cannot generate key using PartitionStrategy.Filters if ecsParameters is not set during instantiation");const e=r.filters||{};o.length&&o.forEach((t=>{e[t]&&delete e[t]}));const t=Object.values(e).filter((e=>void 0!==e||null!==e));t.length&&(s+=`.${t.join(".")}`);break}case f.None:}return{configKey:s,metadataKey:`${s}.metadata`}}class b{constructor(e,t,r){this.serviceName=e,this.ecsParameters=r,this.logger=t.newLogger(`EcsClient_${this.serviceName}`,"services-io-ecs")}async initializeCache(e){this.cache={storage:e.storage,partitionOptions:{strategy:e.partitionBy||f.None,excludeFilters:e.excludeFiltersFromPartition||[],consumerKey:e.consumerKey},invalidate:e.invalidateCache||d.Never,validateCachedData:e.validateCachedData};const{configKey:t,metadataKey:r}=y(this.serviceName,this.cache.partitionOptions,this.ecsParameters);this.logger.debug(`Storage Keys calculated: ${t}, ${r}`);try{const e=await this.cache.storage.getItem(t);if(e){const n=JSON.parse(e),o=await this.cache.storage.getItem(r),i=o?JSON.parse(o):{requestStatus:u.Success};this.data={ecsConfiguration:n,...i},this.logger.log(`Cache successfully loaded: ${t}`)}else this.logger.log(`No cached data found: ${t}`)}catch(e){this.logger.log(`Error while loading from cache '${t}', error:`,e)}}get(){return this.cache?.invalidate===d.OnExpiry&&this.cacheState===l.Expired&&(this.logger.log("Cache expired, clearing cache"),this.clearCache()),this.data}get expiration(){const e=this.data?.headers?.Expires;return e&&new Date(e)}get cacheState(){return void 0===this.cache?l.NoCache:this.data?this.cache.validateCachedData&&!this.cache.validateCachedData(this.data)?l.Invalid:this.expiration&&this.expiration.valueOf()>Date.now()?l.Valid:l.Expired:l.NoData}getDiagnosticInfo(){return{serviceName:this.serviceName,ecsParameters:this.ecsParameters,expirationTime:this.expiration}}async clearCache(){if(this.data=void 0,void 0===this.cache)return;const{configKey:e,metadataKey:t}=y(this.serviceName,this.cache.partitionOptions,this.ecsParameters);await this.cache.storage.removeItem(e),await this.cache.storage.removeItem(t),this.logger.log(`Cache for '${e}' and ${t} cleared.`)}}var g=function(e){return function(t,r,n){for(var o=-1,i=Object(t),s=n(t),a=s.length;a--;){var c=s[e?a:++o];if(!1===r(i[c],c,i))break}return t}}();var m=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n},v="object"==typeof global&&global&&global.Object===Object&&global,E="object"==typeof self&&self&&self.Object===Object&&self,w=v||E||Function("return this")(),T=w.Symbol,_=Object.prototype,O=_.hasOwnProperty,S=_.toString,R=T?T.toStringTag:void 0;var A=function(e){var t=O.call(e,R),r=e[R];try{e[R]=void 0;var n=!0}catch(e){}var o=S.call(e);return n&&(t?e[R]=r:delete e[R]),o},I=Object.prototype.toString;var j=function(e){return I.call(e)},P=T?T.toStringTag:void 0;var N=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":P&&P in Object(e)?A(e):j(e)};var U=function(e){return null!=e&&"object"==typeof e};var C=function(e){return U(e)&&"[object Arguments]"==N(e)},x=Object.prototype,M=x.hasOwnProperty,D=x.propertyIsEnumerable,F=C(function(){return arguments}())?C:function(e){return U(e)&&M.call(e,"callee")&&!D.call(e,"callee")},L=F,B=Array.isArray;var $=function(){return!1},k="object"==typeof exports&&exports&&!exports.nodeType&&exports,H=k&&"object"==typeof module&&module&&!module.nodeType&&module,q=H&&H.exports===k?w.Buffer:void 0,V=(q?q.isBuffer:void 0)||$,W=/^(?:0|[1-9]\d*)$/;var K=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&W.test(e))&&e>-1&&e%1==0&&e<t};var Q=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},G={};G["[object Float32Array]"]=G["[object Float64Array]"]=G["[object Int8Array]"]=G["[object Int16Array]"]=G["[object Int32Array]"]=G["[object Uint8Array]"]=G["[object Uint8ClampedArray]"]=G["[object Uint16Array]"]=G["[object Uint32Array]"]=!0,G["[object Arguments]"]=G["[object Array]"]=G["[object ArrayBuffer]"]=G["[object Boolean]"]=G["[object DataView]"]=G["[object Date]"]=G["[object Error]"]=G["[object Function]"]=G["[object Map]"]=G["[object Number]"]=G["[object Object]"]=G["[object RegExp]"]=G["[object Set]"]=G["[object String]"]=G["[object WeakMap]"]=!1;var X=function(e){return U(e)&&Q(e.length)&&!!G[N(e)]};var Y=function(e){return function(t){return e(t)}},z="object"==typeof exports&&exports&&!exports.nodeType&&exports,J=z&&"object"==typeof module&&module&&!module.nodeType&&module,Z=J&&J.exports===z&&v.process,ee=function(){try{var e=J&&J.require&&J.require("util").types;return e||Z&&Z.binding&&Z.binding("util")}catch(e){}}(),te=ee&&ee.isTypedArray,re=te?Y(te):X,ne=Object.prototype.hasOwnProperty;var oe=function(e,t){var r=B(e),n=!r&&L(e),o=!r&&!n&&V(e),i=!r&&!n&&!o&&re(e),s=r||n||o||i,a=s?m(e.length,String):[],c=a.length;for(var u in e)!t&&!ne.call(e,u)||s&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||K(u,c))||a.push(u);return a},ie=Object.prototype;var se=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ie)};var ae=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),ce=Object.prototype.hasOwnProperty;var ue=function(e){if(!se(e))return ae(e);var t=[];for(var r in Object(e))ce.call(e,r)&&"constructor"!=r&&t.push(r);return t};var le=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var fe=function(e){if(!le(e))return!1;var t=N(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};var de=function(e){return null!=e&&Q(e.length)&&!fe(e)};var he=function(e){return de(e)?oe(e):ue(e)};var pe=function(e,t){return e&&g(e,t,he)};var ye=function(e){return e};var be=function(e){return"function"==typeof e?e:ye};var ge=function(e,t){return e&&pe(e,be(t))};var me=function(e){return null==e};function ve(e){if(!e)return;if(e.baseDelayMs<3e3)throw new Error("Base delay must be greater than 3000ms.");if(e.exponentialFactor<2)throw new Error("Exponential factor must be greater than 2.");if(e.maxRetries<0)throw new Error("Max retries must be greater than 0.");const r=new Set([t.nW.SERVER_TIMEOUT,t.nW.SERVER_ERROR,t.BQ.RejectHttpError,t.BQ.FailedToFetch]);return{shouldRetry:(t,n)=>t<e.maxRetries&&r.has(n),nextDelay:t=>e.baseDelayMs*Math.pow(e.exponentialFactor,t)}}const Ee="1.0.0",we="ECSCanary=1",Te="@1js/ecs-client",_e=(e,r,n,o,i)=>Promise.resolve({constructRequest:(t,r,i)=>({apiName:"getConfiguration",url:e,method:"GET",headers:{...n,...o,...i?{"If-None-Match":i}:void 0},correlationId:t}),customTelemetry:Se,transformResponse:Re(r),allowedResponses:[t.nW.OK,t.nW.NOT_MODIFIED,t.nW.CREATED,t.nW.NO_CONTENT],retryPolicy:ve(i)});function Oe(e){const{ecsParameters:t,serviceName:r,logger:n,retryPolicy:o}=e,i=function(e){return`${e.domain}/config/v1/${e.client}/`}(t),s=function(e){const t=[];if(ge(e.filters,((e,r)=>{me(e)||(B(e)?e.forEach((e=>{t.push(`${r}=${e}`)})):t.push(`${r}=${e}`))})),e.agents){const r=e.agents.join(",");t.push(`agents=${r}`)}return t.push(we),`${e.version}?${t.join("&")}`}(t),a=function(e){return{"X-ECS-Client-Last-Telemetry-Events":`ecs_client_library_name=${Te},ecs_client_app_name=${e},ecs_client_version=${Ee}`}}(r);return{endpointUrl:`${i}${s}`,endpointModels:()=>({baseUrl:i,serviceName:r,models:{getConfigurationAsync:_e(s,n,a,t.additionalHeaders,o)}})}}function Se(e,t,r){return JSON.stringify({correlationId:e,serviceName:t,eTag:r,initialFetch:void 0===r})}const Re=e=>async r=>{switch(e.debug(`Response headers: ${JSON.stringify(r.headers)}`),r.status){case t.nW.OK:{const t=await r.body.json(),n=r.headers.expires??t.Headers.Expires,o=r.headers.etag??t.Headers.ETag,i=t.Headers.CountryCode;return{requestStatus:u.Success,ecsConfiguration:t,headers:Ae(e,n,o,i)}}case t.nW.NOT_MODIFIED:case t.nW.CREATED:case t.nW.NO_CONTENT:return{requestStatus:u.Success_NoChanges,headers:Ae(e,r.headers.expires,r.headers.etag)};default:throw new Error(`Response status ${r.status} unexpectedly allowed`)}},Ae=(e,t,r,n)=>{let o=Date.parse(t);if(isNaN(o)){const e=t.match(/\d+/g);if(e&&1===e.length&&(o=Number.parseInt(t,10)),isNaN(o))throw new Error(`Invalid or missing expiration date: '${t}'`)}if(!r)throw new Error("Missing etag value");return n||e.warn("Missing country code"),{ETag:r,Expires:new Date(o),CountryCode:n}};class Ie extends b{constructor(e,t,r,n,o,i,s,a){super(e,r,t),this.ecsParameters=t,this.endpointsManager=n,this.fetchPrecheck=o,this.fetchRetryPolicy=i,this.transformData=s,this.fetchMode=c.Manual,this._didFetch=!1,this.clientType="EcsClient";const{endpointUrl:u,endpointModels:l}=Oe({ecsParameters:t,serviceName:e,logger:this.logger,retryPolicy:i});this.fetchUrl=u,this.ecsApi=this.endpointsManager.createApi(l),a&&(this.data=a.data,this.cache=a.cache)}get didFetch(){return this._didFetch}async fetch(){const e=void 0===this.eTag,t=h();this.lastAttemptedFetch=new Date,this.logger.log(`Getting ECS configuration from ${this.fetchUrl}. correlationId=${t}, isInitialFetch=${e}`);const r=this.fetchPrecheck?.()||!0;if(!0!==r)return this.scheduleNextConfigurationFetch(),this.logger.debug(`${r.errorMessage}. correlationId=${t}`),{requestStatus:r.requestStatus};try{const r=await this.ecsApi.getConfigurationAsync(t,this.serviceName,this.eTag);this.logger.log(`ECS configuration fetch complete. status=${u[r.requestStatus]}, correlationId=${t}, isInitialFetch=${e}`),this.data=this.onSuccess(r,t),this._didFetch=!0,this.configIds=r.ecsConfiguration?.ConfigIDs,this.updateCache()}catch(e){return this.onError(e,t)}finally{this.scheduleNextConfigurationFetch()}return this.data}startFetchSchedule(e,t){this.host=e,this.callbackFunction=t,this.fetchMode=c.WhenExpired,this.logger.debug("Starting ECS configuration fetch schedule in WhenExpired mode."),this.scheduleNextConfigurationFetch()}updateParameters(e){const t=this.fetchUrl,{endpointUrl:r,endpointModels:n}=Oe({ecsParameters:e,serviceName:this.serviceName,logger:this.logger,retryPolicy:this.fetchRetryPolicy});return this.fetchUrl=r,this.ecsApi=this.endpointsManager.createApi(n),this.ecsParameters=e,t!==this.fetchUrl}dispose(){this.fetchMode=c.Manual,this.clearConfigurationFetchSchedule()}getDiagnosticInfo(){return{serviceName:this.serviceName,configIds:this.configIds,ecsParameters:this.ecsParameters,etag:this.eTag,fetchUrl:this.fetchUrl,lastAttemptedFetch:this.lastAttemptedFetch,lastSuccessfulFetch:this.lastSuccessfulFetch,nextScheduledFetch:this.nextScheduledFetch,fetchMode:this.fetchMode,expirationTime:this.expiration}}get eTag(){if(this.cacheState!==l.Invalid)return this.data?.headers?.ETag}async updateCache(){if(void 0===this.cache)return;const{storage:e}=this.cache,{configKey:t,metadataKey:r}=y(this.serviceName,this.cache.partitionOptions,this.ecsParameters);if(!this.data?.ecsConfiguration||0===Object.keys(this.data.ecsConfiguration).length)return void this.logger.log(`updateCache() received empty data. Cache State: ${l[this.cacheState]} (Storage key: ${t})`);const{ecsConfiguration:n,...o}=this.data;await e.setItem(t,JSON.stringify(n)),await e.setItem(r,JSON.stringify(o)),this.logger.log(`Cache '${t}' updated.`)}onSuccess(e,t){let r;switch(e.requestStatus){case u.Success:if(!e.ecsConfiguration)throw new Error("ECS configuration is unexpectedly undefined on a successful response");if(!e.headers)throw new Error("Headers object is unexpectedly undefined on a successful response");if(!this.ecsParameters.disableSentinelConfigValidation&&!this.validateSentinelConfig(e.ecsConfiguration))throw new Error("Sentinel Config is missing from response");r=this.transformData?.(e)||e;break;case u.Success_NoChanges:if(!e.headers)throw new Error("Headers object is unexpectedly undefined on a successful response");r={...this.data,requestStatus:e.requestStatus,headers:e.headers},this.logger.debug(`ECS configuration is unchanged. eTag=${this.eTag}, correlationId=${t}`);break;default:throw new Error(`Received unexpected request status of ${u[e.requestStatus]}`)}return this.lastSuccessfulFetch=this.lastAttemptedFetch,r.fetchParams=this.ecsParameters,r}onError(e,r){const n=this.processErrorText(e,"unknown error");let o=u.Error_Unknown;switch(e.reason){case t.BQ.TimedOut:o=u.Error_TimedOut;break;case t.BQ.TransformFailed:o=u.Error_TransformFailed;break;default:o=e?.reason===t.BQ.RejectHttpError&&void 0===e?.serverResponse?.status?u.Error_BrowserError:u.Error_Unknown}return this.logger.error(`Fetching ECS configuration failed. error=${e}, innerExceptionMessage=${e.innerException?.message} correlationId=${r}`),{requestStatus:o,errorMessage:n}}processErrorText(e,t){let r=t;return e&&(r=Object.keys(e)?.length>0?JSON.stringify(e):e.message,e.innerException&&(r+=` innerExceptionMessage: ${e.innerException.message}`)),r}validateSentinelConfig(e){return e[p]?(this.logger.log("ECS Sentinel Config is present in ECS response at the root level"),!0):e.ECS?.[p]?(this.logger.log("ECS Sentinel Config is present in ECS response inside ECS object"),!0):(this.logger.error("ECS Sentinel Config is missing from ECS response"),!1)}clearConfigurationFetchSchedule(){this.setTimeoutHandle&&this.host&&(this.host.clearTimeout(this.setTimeoutHandle),this.setTimeoutHandle=void 0,this.logger.debug("Cleared existing queued configuration fetch"))}scheduleNextConfigurationFetch(){if(this.clearConfigurationFetchSchedule(),this.fetchMode===c.Manual)return void this.logger.debug("No need to queue configuration fetch in manual mode, ignoring...");if(!this.host)return void this.logger.error("No host provided, cannot schedule next configuration fetch");const e=this.calculateFetchInterval();this.setTimeoutHandle=this.host.setTimeout((async()=>{const e=await this.fetch();this.callbackFunction&&this.callbackFunction(e)}),e),this.nextScheduledFetch=new Date(Date.now()+e),this.logger.debug(`Next ECS configuration fetch will occur in ${e}ms at ${this.nextScheduledFetch}`)}calculateFetchInterval(){if(this.fetchMode===c.Manual)throw new Error(`Calculating fetch interval is not supported when using ${c[this.fetchMode]} fetch mode.`);const e=(this.expiration??new Date).valueOf()-Date.now();return e<Ie.MinimumRefreshIntervalInMilliseconds?(this.logger.warn(`Calculated refresh interval of ${e}ms based on expires header was below the allowed minimum of ${Ie.MinimumRefreshIntervalInMilliseconds}ms. Minimum value will be used instead.`),Ie.MinimumRefreshIntervalInMilliseconds):e}}function je(){return window.O365ShellContext&&window.O365ShellContext.Logger}Ie.MinimumRefreshIntervalInMilliseconds=18e5;class Pe{setItem(e,t){return new Promise((r=>{var n;try{globalThis.localStorage.setItem(e,t)}catch(t){null===(n=je())||void 0===n||n.tag("ECSCache_FailedToSetItemInLocalStorage",4,`Failed to set item in localStorage for key: ${e}. Error: ${t}`)}r()}))}getItem(e){return new Promise((t=>{var r;try{t(globalThis.localStorage.getItem(e))}catch(n){null===(r=je())||void 0===r||r.tag("ECSCache_FailedToGetItemFromLocalStorage",4,`Failed to get item from localStorage for key: ${e}. Error: ${n}`),t(null)}}))}removeItem(e){return new Promise((t=>{var r;try{globalThis.localStorage.removeItem(e)}catch(t){null===(r=je())||void 0===r||r.tag("ECSCache_FailedToRemoveItemFromLocalStorage",4,`Failed to remove item from localStorage for key: ${e}. Error: ${t}`)}t()}))}}class Ne{constructor(e){this.label=e}error(e,...t){}warn(e,...t){}debug(e,...t){}log(e,...t){}}class Ue{newLogger(e){return new Ne(e)}}function Ce(e){}window.createClient=r=>e(void 0,void 0,void 0,(function*(){return yield async function({serviceName:e,ecsParameters:t,cacheOptions:r,loggerFactory:n,endpointsManager:o,fetchPrecheck:i,fetchRetryPolicy:s,transformData:a}){const c=new Ie(e,t,n,o,i,s,a);return await c.initializeCache(r),c}({serviceName:"Oneshell",loggerFactory:new Ue,ecsParameters:r,endpointsManager:(0,t.Q_)({},{globalContext:globalThis,telemetryProvider:Ce,configuration:{modelInitializationTimeoutInMs:1e3,baseUrlResolutionTimeoutInMs:3e3,defaultRequestTimeoutInMs:4e3}}),cacheOptions:{storage:new Pe},fetchRetryPolicy:{retryType:"exponential-backoff",baseDelayMs:3e3,exponentialFactor:2,maxRetries:2}})}))}()}();